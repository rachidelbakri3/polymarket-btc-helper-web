<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>BTC Up/Down Helper – Live</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--pill:#0b1020;}
  body{font-family:system-ui,Arial; background:var(--bg); color:var(--text); margin:0; padding:22px}
  h1{margin:0 0 14px; text-align:center}
  .wrap{max-width:520px;margin:0 auto}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,.25)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .kpi{display:grid;grid-template-columns:1fr auto;gap:6px;background:var(--pill);padding:10px;border-radius:10px;margin-top:10px}
  label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
  input,button{width:100%;padding:12px;border-radius:12px;border:1px solid #374151;background:#0b1020;color:var(--text)}
  button{border:0;background:#2563eb;font-weight:700;cursor:pointer;margin-top:12px}
  .foot{margin-top:10px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <h1>BTC Up/Down Helper (Live)</h1>
  <div class="card">
    <div class="row">
      <div class="kpi"><span>BTC (USDT)</span><b id="btc">—</b></div>
      <div class="kpi"><span>Minutes Left (UTC)</span><b id="mins">—</b></div>
    </div>

    <div class="kpi"><span>Price to Beat (1h open, UTC)</span><b id="ptb">—</b></div>
    <div class="kpi"><span>Volatility / min (last <span id="winLbl">15</span>m)</span><b id="vol">—</b></div>
    <div class="kpi"><span>Expected Move</span><b id="exp">—</b></div>

    <label>Current Up Price (from Polymarket)</label>
    <input id="up" type="number" step="0.01" placeholder="e.g. 0.62 (62¢)"/>
    <button id="recalc">Calculate</button>

    <div class="row">
      <div class="kpi"><span>Up %</span><b id="upPct">—</b></div>
      <div class="kpi"><span>Down %</span><b id="dnPct">—</b></div>
    </div>
    <div class="kpi"><span>Signal</span><b id="sig">—</b></div>

    <div class="foot" id="stamp">—</div>
  </div>
</div>

<script>
const fmt=(n,d=2)=>Number.isFinite(n)?n.toFixed(d):"—";

// نافذة الساعة الحالية UTC (لباينانس)
function hourWindowUTC(){
  const now = new Date();
  const start = new Date(Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),now.getUTCHours(),0,0));
  const end   = new Date(start.getTime()+3600*1000);
  const minsLeft = Math.max(0, Math.floor((end-now)/60000));
  return {startMs:start.getTime(), end, minsLeft};
}

// افتتاح شمعة 1h الحالية من Binance
async function fetchHourOpen(startMs){
  const url=`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=${startMs}&limit=1`;
  const r=await fetch(url,{cache:'no-store'}); const j=await r.json();
  return (Array.isArray(j)&&j.length)?parseFloat(j[0][1]):null;
}

// WebSocket للسعر الحي
let ws, lastPrice=NaN, ptb=NaN, minsLeft=0;
const windowMinutes = 15; // غيّرها إذا تريد
document.getElementById('winLbl').textContent = windowMinutes;

// نخزن الأسعار
